/**
 * ScrollWatch 1.3 / jQuery plugin
 * @author ShiraNai7
 */
void function(c){function b(f,e){if(window===e||undefined===e){e=null}var g=0;do{g+=f.offsetTop}while((f=f.offsetParent)&&f!==e);return g}function a(e){var f=0;do{f+=e.offsetTop}while((e=e.offsetParent));return f}function d(g,f,h,e){if(h>f||e<g){return null}return[g>h?g:h,f>e?e:f]}c.fn.scrollWatch=function(s){s=c.extend({},c.fn.scrollWatch.defaults,s);if(typeof s.callback!=="function"){throw new Error('The "callback" option is required and must be a function')}var g=this,o,l=c(s.scroller),p=(window===s.scroller),r,h,k=null,n=false;if(0===g.length){throw new Error("No sections found")}var j;function q(){o=[];g.each(function(){var t=b(this,s.scroller);j=t+this.offsetHeight;o.push([t,j,j-t])});o.sort(function(u,t){return u[0]-t[0]})}function i(){if(p){r=c(window).height();h=window.scrollHeight}else{r=s.scroller.clientHeight;h=s.scroller.scrollHeight}}function m(){if(n){return}var y=l.scrollTop(),A=y+r;if(0!==s.viewMarginTop){y+=s.viewMarginTop}if(0!==s.viewMarginBottom){A=Math.max(y+1,A-s.viewMarginBottom)}var v=[],x,u;if(h-A<5){var D=o.length-1;x=d(y,A,o[D][0],o[D][1]);v.push({index:D,focusIntersection:x,focusHeight:(null===x)?null:(x[1]-x[0]),elem:g[D],isFull:u>=o[D][2],asClosest:false})}else{if(y-s.viewMarginTop<5){x=d(y,A,o[0][0],o[0][1]);v.push({index:0,focusIntersection:x,focusHeight:(null===x)?null:(x[1]-x[0]),elem:g[0],isFull:u>=o[0][2],asClosest:false})}else{for(var B=0;B<o.length;++B){x=d(y,A,o[B][0],o[B][1]);if(null!==x){v.push({index:B,focusIntersection:x,focusHeight:x[1]-x[0],elem:g[B],isFull:u>=o[B][2],asClosest:false})}}if(0===v.length){var t=null,C;for(B=0;B<o.length;++B){C=Math.abs(o[B][0]-y);if(null===t||t[1]>C){t=[B,C]}}v.push({index:t[0],focusIntersection:null,focusHeight:null,elem:g[t[0]],isFull:false,asClosest:true})}}}if(!s.multiMode){if(1===v.length){s.callback(v[0],y,A)}else{var w=null;switch(s.resolutionMode){case 0:v.sort(function(F,E){if(F.index<E.index){return E.focusHeight-F.focusHeight-s.topDownWeight}return E.focusHeight-F.focusHeight});w=v[0];break;case 1:var z=y+(A-y)*s.focusRatio+s.focusOffset;if(s.debugFocusLine){if(null===k){f()}k.style.top=Math.round(z)+"px"}for(B=0;B<v.length;++B){if(v[B].focusIntersection[0]<=z&&v[B].focusIntersection[1]>=z){w=v[B];break}}if(null===w){for(B=0;B<v.length;++B){v[B].focusRatioOffsetDistance=Math.min(Math.abs(v[B].focusIntersection[0]-z),Math.abs(v[B].focusIntersection[1]-z))}v.sort(function(F,E){return F.focusRatioOffsetDistance-E.focusRatioOffsetDistance});w=v[0]}break;default:throw new Error("Invalid resolution mode")}s.callback(w,y,A)}}else{s.callback(v,y,A)}}function e(){q();i();m()}function f(){k=document.createElement("div");k.style.width="10%";k.style.height="0";k.style.position="absolute";k.style.left="0";k.style.top="0";k.style.borderTop="1px solid yellow";k.style.borderBottom="1px solid red";k.style.borderRight="3px solid black";k.style.zIndex="9999";k=c(k).appendTo(p?document.body:l)[0]}e();l.scroll(m);if(p){l.resize(e)}return{unbind:function(){l.unbind("scroll",m);if(p){l.unbind("resize",e)}},update:function(){e()},updateFocus:function(){m()},pause:function(){n=true},resume:function(){n=false;m()},setOption:function(t,u){s[t]=u;return this}}};c.fn.scrollWatchMenu=function(n,p){var l=window,h=/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)||/Safari/.test(navigator.userAgent)&&/Apple Computer/.test(navigator.vendor),j,g=null,e=c(h?document.body:"html"),k,o,m=p.callback;p=c.extend({},c.fn.scrollWatchMenu.defaults,p,{callback:function(q){if(q.index<j.length&&q.index!==g){if(null!==g){c(j[g]).removeClass(p.menuActiveClass)}c(j[q.index]).addClass(p.menuActiveClass);g=q.index}if(m){m(q)}}});function f(q,r){e.scrollTop(q+p.menuWindowScrollOffset);if(null!==r){k.scrollTop(r)}}function i(q,r){if(e.is(":animated")){e.stop(true,true)}e.animate({scrollTop:q+p.menuWindowScrollOffset},p.menuScrollSpeed);if(null!==r){if(k.is(":animated")){k.stop(true,true)}k.animate({scrollTop:r+p.menuScrollerScrollOffset},p.menuScrollerScrollSpeed||p.menuScrollSpeed)}}k=c(p.scroller);if(k.length<1){throw new Error("Could not find the scroller element")}if(l===k.get(0)){k=null}j=c(this)[("*"===p.menuItemSelector)?"children":"find"](p.menuItemSelector);if(p.menuHandleHashLinks){if(0!==p.menuScrollOffset&&l.location.hash){c("a",j).each(function(){if(this.hash===l.location.hash){var t=this.hash.substr(1),s=c("#"+t+", [name="+t+"]");if(s.length>0){s=s.get(0);var q=a(s),r=(k?b(s,k.get(0)):null);setTimeout(function(){if(Math.abs(q-e.scrollTop())<p.menuInitialHashOffsetTolerance){f(q,r)}},100);return false}}return true})}if(0!==p.menuScrollOffset||p.menuScrollSpeed>0){c("a",j).click(function(){if(""===this.hash){return true}var v=this.hash.substr(1),u=c("#"+v+", [name="+v+"]"),t=e.scrollTop(),s=(k?k.scrollTop():null),q,r;if(u.length>0){u=u.get(0);q=a(u);r=(k?b(u,k.get(0)):null)}else{return true}o.pause();l.location.hash=v;e.scrollTop(t);if(k){k.scrollTop(s)}o.resume();if(p.menuScrollSpeed>0){i(q,r)}else{f(q,r)}return false})}}o=c(n).scrollWatch(p);c.extend(o,{setMenuOption:function(q,r){p[q]=r;return this},instantScroll:function(q,r){f(q,(null!==k)?r:null)},animatedScroll:function(q,r){i(q,(null!==k)?r:null)}});return o};c.fn.scrollWatch.defaults={callback:null,scroller:window,multiMode:false,resolutionMode:0,topDownWeight:0,viewMarginTop:0,viewMarginBottom:0,focusRatio:0.38196601125010515,focusOffset:0,debugFocusLine:false};c.fn.scrollWatchMenu.defaults={scroller:window,menuActiveClass:"active",menuItemSelector:"*",menuWindowScrollOffset:0,menuScrollerScrollOffset:0,menuScrollSpeed:500,menuScrollerScrollSpeed:null,menuInitialHashOffsetTolerance:40,menuHandleHashLinks:true}}(jQuery);