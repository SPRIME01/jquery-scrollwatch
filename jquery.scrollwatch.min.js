/**
 * ScrollWatch 1.2 / jQuery plugin
 * @author ShiraNai7
 */
void function(d){var a=/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)||/Safari/.test(navigator.userAgent)&&/Apple Computer/.test(navigator.vendor);function c(g,f){if(window===f||undefined===f){f=null}var h=0;do{h+=g.offsetTop}while((g=g.offsetParent)&&g!==f);return h}function b(f){var g=0;do{g+=f.offsetTop}while((f=f.offsetParent));return g}function e(h,g,i,f){if(i>g||f<h){return null}return[h>i?h:i,g>f?f:g]}d.fn.scrollWatch=function(s){s=d.extend({},d.fn.scrollWatch.defaults,s);if(typeof s.callback!=="function"){throw new Error('The "callback" option is required and must be a function')}var g=this,o,l=d(s.scroller),p=(window===s.scroller),r,h,k,n=false;if(0===g.length){return false}var j;function q(){o=[];g.each(function(){var t=c(this,s.scroller);j=t+this.offsetHeight;o.push([t,j,j-t])});o.sort(function(u,t){return u[0]-t[0]})}function i(){if(p){r=d(document.body).height();h=document.getElementsByTagName("html")[0].scrollHeight}else{r=s.scroller.clientHeight;h=s.scroller.scrollHeight}}function m(){if(n){return}var y=l.scrollTop(),A=y+r;if(0!==s.viewMarginTop){y+=s.viewMarginTop}if(0!==s.viewMarginBottom){A=Math.max(y+1,A-s.viewMarginBottom)}var v=[],x,u;if(h-A<5){var D=o.length-1;x=e(y,A,o[D][0],o[D][1]);v.push({index:D,focusIntersection:x,focusHeight:(null===x)?null:(x[1]-x[0]),elem:g[D],isFull:u>=o[D][2],asClosest:false})}else{if(y-s.viewMarginTop<5){x=e(y,A,o[0][0],o[0][1]);v.push({index:0,focusIntersection:x,focusHeight:(null===x)?null:(x[1]-x[0]),elem:g[0],isFull:u>=o[0][2],asClosest:false})}else{for(var B=0;B<o.length;++B){x=e(y,A,o[B][0],o[B][1]);if(null!==x){v.push({index:B,focusIntersection:x,focusHeight:x[1]-x[0],elem:g[B],isFull:u>=o[B][2],asClosest:false})}}if(0===v.length){var t=null,C;for(B=0;B<o.length;++B){C=Math.abs(o[B][0]-y);if(null===t||t[1]>C){t=[B,C]}}v.push({index:t[0],focusIntersection:null,focusHeight:null,elem:g[t[0]],isFull:false,asClosest:true})}}}if(!s.multiMode){if(1===v.length){s.callback(v[0],y,A)}else{var w=null;switch(s.resolutionMode){case 0:v.sort(function(F,E){if(F.index<E.index){return E.focusHeight-F.focusHeight-s.topDownWeight}return E.focusHeight-F.focusHeight});w=v[0];break;case 1:var z=y+(A-y)*s.focusRatio;if(s.debugFocusLine){k.style.top=Math.round(z)+"px"}for(B=0;B<v.length;++B){if(v[B].focusIntersection[0]<=z&&v[B].focusIntersection[1]>=z){w=v[B];break}}if(null===w){for(B=0;B<v.length;++B){v[B].focusRatioOffsetDistance=Math.min(Math.abs(v[B].focusIntersection[0]-z),Math.abs(v[B].focusIntersection[1]-z))}v.sort(function(F,E){return F.focusRatioOffsetDistance-E.focusRatioOffsetDistance});w=v[0]}break;default:throw new Error("Invalid resolution mode")}s.callback(w,y,A)}}else{s.callback(v,y,A)}}function f(){q();i();m()}if(s.debugFocusLine&&1===s.resolutionMode){k=document.createElement("div");k.style.width="100%";k.style.height="0";k.style.position="absolute";k.style.left="0";k.style.top="0";k.style.borderTop="1px solid yellow";k.style.borderBottom="1px solid red";k.style.zIndex="9999";k=d(k).appendTo(p?document.body:l)[0]}f();l.scroll(m);if(p){l.resize(f)}return{unbind:function(){l.unbind("scroll",m);if(p){l.unbind("resize",f)}},update:function(){f()},pause:function(){n=true},resume:function(){n=false;m()}}};d.fn.scrollWatchMenu=function(k,h){var g,j=null,f=d(a?document.body:"html"),i;h=d.extend({},d.fn.scrollWatch.defaults,d.fn.scrollWatchMenu.defaults,h,{callback:function(l){if(l.index<g.length&&l.index!==j){if(null!==j){d(g[j]).removeClass(h.menuActiveClass)}d(g[l.index]).addClass(h.menuActiveClass);j=l.index}}});g=d(this)[("*"===h.menuItemSelector)?"children":"find"](h.menuItemSelector);if(0!==h.menuScrollOffset&&window.location.hash){d("a",g).each(function(){if(this.hash===window.location.hash){var n=this.hash.substr(1),m=d("#"+n+", [name="+n+"]");if(m.length>0){var l=b(m.get(0));setTimeout(function(){if(Math.abs(l-f.scrollTop())<h.menuInitialHashOffsetTolerance){f.scrollTop(l+h.menuScrollOffset)}},100);return false}}return true})}if(0!==h.menuScrollOffset||h.menuScrollSpeed>0){d("a[href^=#]",g).click(function(){var o=this.hash.substr(1),n=d("#"+o+", [name="+o+"]"),m=f.scrollTop(),l;i.pause();window.location.hash=o;f.scrollTop(m);i.resume();if(n.length>0){n=n.get(0);l=b(n)+h.menuScrollOffset}else{return true}if(h.menuScrollSpeed>0){if(f.is(":animated")){f.stop(true,true)}d(f).animate({scrollTop:l},h.menuScrollSpeed)}else{f.scrollTop(l)}return false})}return i=d(k).scrollWatch(h)};d.fn.scrollWatch.defaults={callback:null,scroller:window,multiMode:false,resolutionMode:0,topDownWeight:0,viewMarginTop:0,viewMarginBottom:0,focusRatio:0.38196601125010515,debugFocusLine:false};d.fn.scrollWatchMenu.defaults={menuActiveClass:"active",menuItemSelector:"*",menuScrollOffset:0,menuScrollSpeed:500,menuInitialHashOffsetTolerance:40}}(jQuery);